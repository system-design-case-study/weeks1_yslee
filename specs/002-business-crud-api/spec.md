# Feature Specification: 사업장 CRUD API

**Feature Branch**: `002-business-crud-api`
**Created**: 2026-02-08
**Status**: Draft
**Input**: User description: "사업장 CRUD API"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 사업장 상세 조회 (Priority: P1)

검색 결과 목록에서 특정 가게를 선택한 사용자가 이름, 주소, 전화번호, 영업시간, 카테고리 등 전체 정보를 확인한다.

**Why this priority**: Phase 1에서 주변 검색 API가 ID+좌표만 반환하므로, 상세 정보 조회가 없으면 검색 결과를 의미 있게 활용할 수 없다. 기존 기능의 완성도를 높이는 가장 직접적인 기능이다.

**Independent Test**: 사업장 ID로 상세 조회 API를 호출하여 전체 필드가 반환되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 시스템에 사업장 데이터가 존재할 때, **When** 유효한 사업장 ID로 상세 조회하면, **Then** 이름, 주소, 위경도, 카테고리, 전화번호, 영업시간, 등록/수정 일시를 포함한 전체 정보를 반환한다.
2. **Given** 존재하지 않는 사업장 ID로 조회하면, **When** 상세 조회 API를 호출하면, **Then** 404 Not Found와 명확한 오류 메시지를 반환한다.

---

### User Story 2 - 신규 사업장 등록 (Priority: P2)

사업자가 자신의 가게 정보(이름, 주소, 위경도, 카테고리 등)를 시스템에 등록한다. 등록 즉시 검색 인덱스에 반영되어 주변 검색에 노출된다.

**Why this priority**: 검색 서비스에 데이터를 공급하는 핵심 경로. 등록이 없으면 시스템에 새로운 사업장이 추가될 수 없다.

**Independent Test**: 사업장 등록 API로 데이터를 생성한 뒤, 해당 위치 근처에서 주변 검색 시 결과에 나타나는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 유효한 사업장 정보(이름, 주소, 위경도, 카테고리)를 제출하면, **When** 등록 API를 호출하면, **Then** 사업장이 저장되고 고유 ID가 발급되며 201 Created를 반환한다.
2. **Given** 등록 완료 직후, **When** 해당 좌표 근처에서 주변 검색하면, **Then** 새로 등록한 사업장이 검색 결과에 포함된다.
3. **Given** 필수 필드(이름, 위도, 경도)가 누락된 요청을 보내면, **When** 등록 API를 호출하면, **Then** 400 Bad Request와 누락 필드를 명시한 오류 메시지를 반환한다.

---

### User Story 3 - 사업장 정보 수정 (Priority: P3)

사업자가 등록된 가게의 정보(이름, 전화번호, 영업시간 등)를 수정한다. 좌표가 변경된 경우에만 검색 인덱스를 갱신한다.

**Why this priority**: 사업장 정보는 시간이 지나면 변경될 수 있으며, 최신 정보를 유지해야 사용자 신뢰를 확보할 수 있다.

**Independent Test**: 사업장 정보 수정 후 상세 조회 시 변경 내용이 반영되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 등록된 사업장이 있을 때, **When** 유효한 수정 데이터로 수정 API를 호출하면, **Then** 정보가 갱신되고 200 OK를 반환한다.
2. **Given** 사업장 좌표(위도/경도)를 변경하면, **When** 수정 API를 호출하면, **Then** 검색 인덱스에도 새 좌표가 반영되어 변경된 위치 근처에서 검색된다.
3. **Given** 존재하지 않는 사업장 ID로 수정 요청하면, **When** 수정 API를 호출하면, **Then** 404 Not Found를 반환한다.

---

### User Story 4 - 사업장 삭제 (Priority: P4)

사업자가 더 이상 운영하지 않는 가게를 시스템에서 삭제한다. 삭제 즉시 검색 인덱스에서도 제거된다.

**Why this priority**: 폐업한 사업장이 검색에 계속 노출되면 사용자 경험이 나빠진다. 다만 등록/조회/수정보다 빈도가 낮아 우선순위가 뒤이다.

**Independent Test**: 사업장 삭제 후 해당 ID로 조회 시 404가 반환되고, 주변 검색에서도 제외되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 등록된 사업장이 있을 때, **When** 삭제 API를 호출하면, **Then** 사업장이 삭제되고 204 No Content를 반환한다.
2. **Given** 삭제 완료 직후, **When** 해당 좌표 근처에서 주변 검색하면, **Then** 삭제된 사업장이 검색 결과에 포함되지 않는다.
3. **Given** 존재하지 않는 사업장 ID로 삭제 요청하면, **When** 삭제 API를 호출하면, **Then** 404 Not Found를 반환한다.

---

### Edge Cases

- 좌표 범위를 벗어난 값으로 등록/수정 시도 (위도 ±90 초과, 경도 ±180 초과) → 400 Bad Request + 유효 범위 안내
- 이름이 빈 문자열이거나 극단적으로 긴 문자열 (255자 초과) → 적절한 검증 오류 반환
- 카테고리가 사전 정의된 목록에 없는 값 → 400 Bad Request + 허용 카테고리 안내
- 동일 좌표에 중복 사업장 등록 → 허용 (같은 건물 내 여러 가게 가능)
- 등록 시 DB 저장은 성공했으나 검색 인덱스 갱신 실패 → 사용자에게 등록 성공 응답하되, 검색 반영 지연 가능성을 허용하고 복구 메커니즘으로 보정

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 사업장 ID로 상세 정보(이름, 주소, 위경도, 카테고리, 전화번호, 영업시간, 등록/수정일시)를 조회할 수 있어야 한다
- **FR-002**: 시스템은 필수 정보(이름, 위도, 경도)와 선택 정보(주소, 카테고리, 전화번호, 영업시간)로 신규 사업장을 등록할 수 있어야 한다
- **FR-003**: 사업장 등록 시 고유 식별자(UUID)를 자동 발급해야 한다
- **FR-004**: 사업장 등록/삭제 시 검색 인덱스에 즉시 반영해야 한다 (ADR-4 앱 레벨 동기화)
- **FR-005**: 사업장 수정 시 좌표 변경이 있을 경우에만 검색 인덱스를 갱신해야 한다
- **FR-006**: 시스템은 기존 사업장의 모든 필드를 수정할 수 있어야 한다
- **FR-007**: 시스템은 사업장을 삭제할 수 있어야 한다
- **FR-008**: 입력값 검증을 수행해야 한다 (좌표 범위, 필수 필드, 카테고리 유효성, 문자열 길이)
- **FR-009**: 존재하지 않는 사업장에 대한 조회/수정/삭제 요청 시 404 응답을 반환해야 한다
- **FR-010**: 카테고리는 사전 정의된 값 목록(korean_food, cafe, convenience 등)으로 제한해야 한다

### Key Entities

- **Business (사업장)**: 서비스의 핵심 엔티티. 이름, 주소, 위경도 좌표, 카테고리, 전화번호, 영업시간을 가진다. Phase 1에서 정의한 스키마를 그대로 사용한다.
- **Category (카테고리)**: 사업장 분류 체계. 사전 정의된 값 목록으로 관리한다 (korean_food, chinese_food, japanese_food, western_food, cafe, bar, convenience, pharmacy, hair_salon, gym).

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사업장 상세 조회 요청이 1초 이내에 완료된다
- **SC-002**: 신규 등록된 사업장이 등록 직후 주변 검색 결과에 포함된다
- **SC-003**: 삭제된 사업장이 삭제 직후 주변 검색 결과에서 제외된다
- **SC-004**: 모든 CRUD 작업에서 잘못된 입력에 대해 명확한 오류 메시지가 반환된다
- **SC-005**: 좌표 변경 없는 사업장 수정이 검색 인덱스 성능에 영향을 주지 않는다

## Assumptions

- Phase 1에서 구현한 Business 엔티티, Redis GEO 인덱스, 주변 검색 API를 그대로 활용한다
- 인증/인가는 스터디 범위에서 제외하며, 모든 API는 인증 없이 접근 가능하다 (PRD 1.1 범위 참고)
- 사업장 CRUD의 쓰기 트래픽은 하루 수십~수백 건 수준으로 매우 낮다 (PRD ADR-4 참고)
- 페이지네이션은 목록 조회가 아닌 개별 조회이므로 불필요하다
