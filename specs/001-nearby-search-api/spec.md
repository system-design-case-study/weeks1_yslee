# Feature Specification: 주변 검색 API (Nearby Search API)

**Feature Branch**: `001-nearby-search-api`
**Created**: 2026-02-06
**Status**: Draft
**Input**: Phase 1 — Redis GEO 기반 위치 검색 및 Geohash 인덱싱

## User Scenarios & Testing *(mandatory)*

### User Story 1 — 반경 내 사업장 검색 (Priority: P1)

사용자가 현재 위치를 기반으로 주변 사업장을 찾는다.
위도, 경도, 검색 반경을 전달하면 거리순으로 정렬된 사업장 목록을 받는다.

**Why this priority**: 서비스의 핵심 기능이다. 이것 없이는 나머지 기능이 의미 없다.

**Independent Test**: 위도/경도/반경을 전달하여 검색 API를 호출하고,
반환된 목록이 거리순으로 정렬되어 있으며 반경 내 결과만 포함하는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 검색 인덱스에 사업장 데이터가 존재하는 상태에서,
   **When** 사용자가 위도 37.5012, 경도 127.0396, 반경 1000m으로 검색하면,
   **Then** 해당 반경 내 사업장 목록이 가까운 순서대로 반환된다.

2. **Given** 검색 인덱스에 사업장 데이터가 존재하는 상태에서,
   **When** 사용자가 반경을 지정하지 않고 검색하면,
   **Then** 기본 반경 5000m이 적용되어 결과가 반환된다.

3. **Given** 검색 인덱스에 사업장 데이터가 존재하는 상태에서,
   **When** 사용자가 반경 500m으로 검색하여 3건의 결과가 있으면,
   **Then** 각 결과에는 사업장 ID, 이름, 주소, 좌표, 거리(m), 카테고리가 포함된다.

---

### User Story 2 — 검색 결과 없음 처리 (Priority: P2)

사용자가 검색했지만 반경 내에 사업장이 없는 경우, 빈 결과와 안내를 받는다.

**Why this priority**: P1의 정상 흐름 다음으로 가장 빈번하게 발생하는 케이스다.
결과가 없을 때 사용자가 다음 행동을 취할 수 있도록 안내해야 한다.

**Independent Test**: 사업장이 없는 지역의 좌표로 검색하고,
빈 배열과 반경 확대 안내 메시지가 반환되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 반경 내에 사업장이 없는 좌표에서,
   **When** 사용자가 검색하면,
   **Then** 빈 목록(total: 0)과 함께 반경 확대를 권유하는 메시지가 반환된다.

---

### User Story 3 — 잘못된 입력 처리 (Priority: P3)

사용자가 잘못된 좌표값이나 범위를 벗어난 파라미터로 검색을 시도한다.

**Why this priority**: 입력 검증은 안정성의 기본이지만,
P1/P2가 동작한 뒤에 보강해도 MVP에 지장이 없다.

**Independent Test**: 유효 범위를 벗어난 위도/경도로 검색하고,
적절한 에러 응답과 유효 범위 안내가 반환되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 위도 91(유효 범위: -90~90)로 검색하면,
   **When** 검색 API를 호출하면,
   **Then** 에러 응답과 함께 "위도는 -90에서 90 사이여야 합니다" 안내가 반환된다.

2. **Given** 사용자가 경도 200(유효 범위: -180~180)으로 검색하면,
   **When** 검색 API를 호출하면,
   **Then** 에러 응답과 함께 "경도는 -180에서 180 사이여야 합니다" 안내가 반환된다.

3. **Given** 사용자가 반경 50000m(최대: 20000m)으로 검색하면,
   **When** 검색 API를 호출하면,
   **Then** 에러 응답과 함께 "검색 반경은 최대 20000m입니다" 안내가 반환된다.

---

### Edge Cases

- 사업장이 정확히 반경 경계선 위에 있는 경우 → 결과에 포함한다 (경계값 포함).
- 위도/경도가 0, 0인 경우 (대서양 한가운데) → 유효한 좌표이므로 정상 처리한다.
- 매우 좁은 반경(1m)으로 검색하는 경우 → 정상 처리하되 결과가 없을 수 있다.
- 같은 위치에 여러 사업장이 존재하는 경우 → 모두 반환하며 거리는 동일하게 표시된다.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 위도, 경도, 반경을 입력받아 반경 내 사업장 목록을 반환해야 한다(MUST).
- **FR-002**: 검색 결과는 요청 좌표로부터의 거리순(가까운 순)으로 정렬되어야 한다(MUST).
- **FR-003**: 각 검색 결과에는 사업장 ID, 이름, 주소, 위도, 경도, 거리(m), 카테고리가 포함되어야 한다(MUST).
- **FR-004**: 반경 미지정 시 기본값 5000m이 적용되어야 한다(MUST).
- **FR-005**: 반경의 최대값은 20000m이며, 초과 시 에러를 반환해야 한다(MUST).
- **FR-006**: 위도는 -90~90, 경도는 -180~180 범위를 벗어나면 에러를 반환해야 한다(MUST).
- **FR-007**: 반경 내 결과가 0건일 때 빈 목록과 반경 확대 안내 메시지를 반환해야 한다(MUST).
- **FR-008**: 검색 인덱스에 사업장 데이터를 등록할 수 있어야 한다(MUST). (데이터 시딩용, CRUD는 Phase 2에서 구현)

### Key Entities

- **Business (사업장)**: 검색 대상. ID, 이름, 주소, 위도, 경도, 카테고리, 전화번호, 영업시간을 가진다.
- **Search Result (검색 결과)**: 사업장 정보에 요청 좌표로부터의 거리(m)가 추가된 형태.

### Assumptions

- 검색 인덱스에 데이터가 미리 존재하는 상태에서 검색이 이루어진다. 데이터 등록 흐름은 Phase 2에서 다룬다.
- 카테고리별 필터링은 이 Phase의 범위에 포함하지 않는다. 전체 사업장 대상으로 검색한다.
- 페이지네이션은 포함하지 않는다. 반경 검색 특성상 결과 수가 제한적이다.
- 인증/인가는 이 Phase에서 다루지 않는다. 공개 API로 동작한다.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자가 좌표와 반경을 입력하면 100ms 이내에 검색 결과를 받는다.
- **SC-002**: 반환된 결과의 모든 사업장은 요청 반경 이내에 위치해야 한다 (정확도 100%).
- **SC-003**: 결과는 항상 거리순으로 정렬되어 있어야 한다.
- **SC-004**: 잘못된 입력에 대해 사용자가 이해할 수 있는 에러 메시지와 유효 범위 안내가 제공된다.
- **SC-005**: 검색 결과가 없을 때 사용자가 다음 행동(반경 확대)을 안내받는다.
